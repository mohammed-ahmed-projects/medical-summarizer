<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent for Medical Data Summaries</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f7fafc;
            color: #2d3748;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            box-sizing: border-box;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
            color: #1a202c;
        }

        .disclaimer {
            font-size: 0.875rem;
            color: #718096;
            text-align: center;
            margin-bottom: 2rem;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1a202c;
        }

        textarea {
            width: 100%;
            height: 200px;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
            font-size: 1rem;
            resize: vertical;
        }

        .model-selection {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }

        .model-selection label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .model-selection select {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            background-color: #4c51bf;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #5a64d8;
        }

        #processing-status {
            font-size: 0.875rem;
            color: #4a5568;
            margin-top: 1rem;
        }

        #results {
            margin-top: 2rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 2rem;
        }

        .summary-card {
            background-color: #f7fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .summary-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .summary-card p {
            font-size: 0.875rem;
            margin: 0;
            color: #4a5568;
        }

        #qa-section {
            margin-top: 2rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 2rem;
        }

        #qa-section input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
            font-size: 1rem;
        }

        #qa-section button {
            width: auto;
            display: inline-block;
        }

        #qa-result {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #4a5568;
        }

        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Agent for Medical Data Summaries</h1>
        <p class="disclaimer">
            This AI agent provides summaries based on the text provided by the user. The agent does not provide medical advice.
            The user is solely responsible for the accuracy of the information.
        </p>

        <h2>Input Text</h2>
        <textarea id="inputText" placeholder="Enter or paste medical text here..."></textarea>
        
        <div class="model-selection">
            <label for="summarizationModel">Choose Summarization Model:</label>
            <select id="summarizationModel">
                <option value="sshleifer/distilbart-cnn-12-6" selected>Foundational (General Audience)</option>
                <option value="sshleifer/distilbart-cnn-6-6">Applied (Professionals & Students)</option>
                <option value="t5-small">Advanced (Experts)</option>
            </select>
        </div>
        
        <button id="summarizeBtn">Generate Summaries</button>
        <div id="processing-status"></div>

        <div id="results" style="display: none;">
            <h2>Results</h2>
            <div id="summaryResults"></div>
        </div>

        <div id="qa-section" style="display: none;">
            <h2>Ask Gemini (Q&A)</h2>
            <input type="text" id="qaInput" placeholder="Ask a question about the text...">
            <button id="qaBtn">Get Answer</button>
            <div id="qa-result"></div>
        </div>
    </div>

    <script>
        document.getElementById('summarizeBtn').addEventListener('click', async () => {
            const inputText = document.getElementById('inputText').value;
            const model = document.getElementById('summarizationModel').value;
            const statusDiv = document.getElementById('processing-status');
            const resultsDiv = document.getElementById('results');
            const summaryResultsDiv = document.getElementById('summaryResults');
            const qaSectionDiv = document.getElementById('qa-section');

            if (!inputText.trim()) {
                alert('Please enter some text to summarize.');
                return;
            }

            statusDiv.textContent = 'Processing...';
            resultsDiv.style.display = 'none';
            qaSectionDiv.style.display = 'none';
            summaryResultsDiv.innerHTML = '';

            try {
                const response = await fetch('/api/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: inputText, model: model })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'API call failed');
                }

                const data = await response.json();
                statusDiv.textContent = 'Generating foundational summary...';
                
                summaryResultsDiv.innerHTML += `
                    <div class="summary-card">
                        <h3>Foundational Summary:</h3>
                        <p>${data.summary_text}</p>
                    </div>
                `;
                
                resultsDiv.style.display = 'block';
                qaSectionDiv.style.display = 'block';
                statusDiv.textContent = 'Summaries generated successfully.';

            } catch (error) {
                statusDiv.textContent = 'Error: ' + error.message;
                alert('Error: ' + error.message);
            }
        });

        document.getElementById('qaBtn').addEventListener('click', async () => {
            const context = document.getElementById('inputText').value;
            const question = document.getElementById('qaInput').value;
            const qaResultDiv = document.getElementById('qa-result');

            if (!context.trim() || !question.trim()) {
                alert('Please provide both text and a question.');
                return;
            }

            qaResultDiv.textContent = 'Getting answer...';

            try {
                const response = await fetch('/api/qa', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question, context: context })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'API call failed');
                }

                const data = await response.json();
                qaResultDiv.textContent = `Answer: ${data.answer}`;
            } catch (error) {
                qaResultDiv.textContent = 'Error: ' + error.message;
                alert('Error: ' + error.message);
            }
        });
    </script>
</body>
</html>
